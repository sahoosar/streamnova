# ============================================================================
# Profile: postgres-prod (PostgreSQL PROD environment)
# ============================================================================
# Same as postgres profile with PROD overrides.
# Activate: --spring.profiles.active=postgres-prod
#
# Override with your PROD values or set env vars: POSTGRES_PROD_DATABASE,
# POSTGRES_PROD_USERNAME, POSTGRES_PROD_PASSWORD, POSTGRES_PROD_TABLE.
# Do not commit real credentials; use secrets in deployment.
#
streamnova:
  pipeline:
    listener-config-file: classpath:pipeline_listener_config-prod.yml

pipeline:
  config:
    source:
      jdbc-url: jdbc:postgresql://prod-db-host:5432/${POSTGRES_PROD_DATABASE:marketdb}
      username: ${POSTGRES_PROD_USERNAME:}
      password: ${POSTGRES_PROD_PASSWORD:}
      table: ${POSTGRES_PROD_TABLE:market_summary}

# ── Spring AI / Vertex AI (PROD) ─────────────────────────────────
spring:
  ai:
    vertex:
      ai:
        gemini:
          project-id: ${VERTEX_PROJECT_ID}          # REQUIRED — set via env
          location:   ${VERTEX_LOCATION:us-central1}
          chat:
            options:
              model:             ${AI_CHAT_MODEL:gemini-2.0-flash-001}
              temperature:       0.1
              max-output-tokens: 8192

streamnova:
  ai:
    enabled: true
    agent:
      max-iterations:  10
      timeout-seconds: 60
      retry-attempts:  3
    vertex:
      project-id: ${VERTEX_PROJECT_ID}

# ── Guardrails (PROD) ────────────────────────────────────────────────────────
# Strict production limits. Override via env vars if needed at deploy time.
streamnova:
  guardrails:
    allowed-machine-types: ${GUARDRAIL_ALLOWED_MACHINE_TYPES:n2d-standard-4,n2d-standard-8,n2d-standard-16,n2-standard-4,n2-standard-8,n2-standard-16,c3-standard-4,c3-standard-8}
    machine-family-order: n2d,n2,c3
    max-cost-usd:          ${GUARDRAIL_MAX_COST_USD:20.00}
    max-duration-sec:      ${GUARDRAIL_MAX_DURATION_SEC:7200}   # 2h
    min-throughput-mb-per-sec: ${GUARDRAIL_MIN_THROUGHPUT:10}
    max-workers-global:    ${GUARDRAIL_MAX_WORKERS:8}
    max-shards-global:     ${GUARDRAIL_MAX_SHARDS:64}
    enforce-on-recommend: true
    enforce-on-execute:   true
