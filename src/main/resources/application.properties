spring.application.name=StreamNova

# ============================================================================
# Pipeline profile (choose DB type and environment)
# ============================================================================
# Single DB: postgres (default) | oracle | postgres-sit | oracle-uat | etc.
# Both DBs:  postgres, oracle  (invokes application-postgres + application-oracle; datasources created in parallel)
# Example: --spring.profiles.active=postgres,oracle  when streamnova.statistics.supported-source-types=postgres,oracle
#
# Multiple profiles selected (see MULTI_PROFILE_HANDLING.md):
#   - postgres,oracle: set supported-source-types=postgres,oracle; both YAMLs merge. Set streamnova.pipeline.default-source=postgres (or oracle) to choose default.
#   - postgres,postgres-light: postgres loads config file; postgres-light only sets scenario=light (no conflict).
#   - postgres,postgres-sit: environment overrides (SIT URL/user/password); one env profile at a time.
spring.profiles.active=postgres

# Where to change connection/config per DB and environment:
#   Postgres dev:     application-postgres.properties + postgre_pipeline_config.yml
#   Postgres SIT:     application-postgres-sit.properties (overrides jdbc-url, user, password, table)
#   Postgres UAT:     application-postgres-uat.properties
#   Postgres PROD:    application-postgres-prod.properties
#   Oracle dev:       application-oracle.properties + oracle_pipeline_config.yml
#   Oracle SIT:       application-oracle-sit.properties
#   Oracle UAT:       application-oracle-uat.properties
#   Oracle PROD:      application-oracle-prod.properties
# Shared defaults (pool, sharding, fetch size, etc.): postgre_pipeline_config.yml / oracle_pipeline_config.yml
# Password: no hardcoded passwords. Set POSTGRES_PASSWORD / ORACLE_PASSWORD env vars; pipeline YAML uses ${POSTGRES_PASSWORD}. streamnova.pipeline.config-file is required (no in-memory config).
#
# Different users / machine types: PRODUCTION approach (see PIPELINE_CONFIG_PRODUCTION.md):
#   One YAML with pipeline.config.scenarios (light/heavy/prod). Set STREAMNOVA_PIPELINE_SCENARIO in the deployment
#   (K8s, Dataflow, etc.); use ${POSTGRES_PASSWORD} etc. for secrets. Do not rely on defaultScenario in prod.

# Context path (e.g. when behind a proxy at /streamnova). Use /api/pipeline/table-statistics without this prefix when context-path is empty.
server.servlet.context-path=/streamnova

# Disable DevTools property-defaults log message (optional)
spring.devtools.add-properties=false

# ============================================================================
# Actuator Configuration - Metrics & Monitoring
# ============================================================================
# Enable Actuator endpoints
management.endpoints.web.exposure.include=health,info,metrics,prometheus
management.endpoint.health.show-details=when-authorized
management.endpoint.metrics.enabled=true
management.endpoint.prometheus.enabled=true

# Metrics configuration
management.metrics.export.prometheus.enabled=true
management.metrics.distribution.percentiles-histogram.http.server.requests=true
management.metrics.distribution.sla.http.server.requests=100ms,500ms,1s,2s,5s

# ============================================================================
# Logging Configuration
# ============================================================================
# Root logger
logging.level.root=INFO

# Your package logs (debug if you want more)
logging.level.com.di.streamnova=INFO

# Named loggers used in your helpers
logging.level.DLQ=INFO
logging.level.VALID=INFO

# Guardrails: allowed machine types at execution time. Comma-separated; exact match or family prefix (e.g. n2 allows n2-*).
# n2-standard, n2d-standard (2/8GB, 4/16GB, 8/32GB, 16/64GB, 32/128GB), c3-standard-4/8.
# When set, recommend API and execute(candidate) only allow these types. Empty or unset = no restriction.
streamnova.guardrails.allowed-machine-types=n2d-standard-2,n2-standard-2,n2d-standard-4,c3-standard-4,n2-standard-4,n2d-standard-8,c3-standard-8,n2-standard-8,n2d-standard-16,n2-standard-16
# Default SLA guardrails when client does not pass maxDurationSec/maxCostUsd (empty = no default).
# Example: 3600 = 1h max duration; 10.0 = $10 max cost.
#streamnova.guardrails.max-duration-sec=
#streamnova.guardrails.max-cost-usd=

# Estimator: USD per vCPU-hour by machine family (for cost estimation). Override for region or custom pricing.
streamnova.estimator.usd-per-vcpu-hour.n2=0.031
streamnova.estimator.usd-per-vcpu-hour.n2d=0.027
streamnova.estimator.usd-per-vcpu-hour.c3=0.035
# Optional: USD to GBP rate for getEstimatedCostGbp() display (e.g. 0.79).
streamnova.estimator.usd-to-gbp=0.79
# Estimator: default throughput when no warm-up or history (MB/s). Fallback duration when effective throughput is 0 (seconds).
streamnova.estimator.default-throughput-mb-per-sec=50
streamnova.estimator.fallback-duration-sec=3600
# Estimator: learning signals and throughput history limits (number of past runs to consider).
streamnova.estimator.learning-signals-limit=100
streamnova.estimator.throughput-history-limit=10
# Estimator: source/sink/CPU caps (MB/s). Source caps limit read throughput by DB type; sink caps by load pattern; CPU cap = mb-per-sec-per-vcpu × workers × vCPUs.
streamnova.estimator.source-cap.postgres=500
streamnova.estimator.source-cap.oracle=80
streamnova.estimator.sink-cap.bq-direct=100
streamnova.estimator.sink-cap.gcs-bq=400
streamnova.estimator.cpu-cap-mb-per-sec-per-vcpu=60

# Recommend API: cap on number of candidates generated (Estimator scores each). Lower = faster, higher = more options.
streamnova.recommend.max-candidates=4

# Recommend API: max worker count for candidate generation. Candidates use worker counts 1, 2, 3, … up to this value.
# Increase (e.g. 32) later for more scaling options; lower (e.g. 4) keeps candidate count smaller.
streamnova.recommend.max-workers=4
# Cap on worker count used in WorkerScaling (safety upper bound). Effective max = min(max-workers, max-workers-cap).
streamnova.recommend.max-workers-cap=8

# Pool size: single source of truth = pipeline_config.yml (sources.<name>.maximumPoolSize, fallbackPoolSize).
# Recommend API and capacity max-shards derive from it; no need to duplicate pool size here.
# Fallback pool size when deriving from machine type (used when pool not in config). Should match pipeline fallbackPoolSize.
streamnova.recommend.fallback-pool-size=8

# Execution planner: machine types for candidate generation (order = evaluation order). Empty = use built-in default (n2d, n2, c3).
# Add or reorder types without code changes. Example: n2d-standard-4,n2d-standard-8,n2d-standard-16,n2-standard-4,...,c3-standard-16
streamnova.execution-planner.machine-ladder.types=n2d-standard-4,n2d-standard-8,n2d-standard-16,n2-standard-4,n2-standard-8,n2-standard-16,c3-standard-4,c3-standard-8,c3-standard-16

# Shard planner: fallback max shards when pool size not provided (e.g. tests). When pool from pipeline is passed, it is used as cap.
streamnova.shardplanner.max-shards-cap=16
streamnova.shardplanner.fallback-shards-when-no-vcpus=4
# Machine-type optimizer: record-count fallback targets (when data size MB not available) and size thresholds.
streamnova.shardplanner.high-cpu-target-records-per-shard=20000
streamnova.shardplanner.high-mem-target-records-per-shard=100000
streamnova.shardplanner.standard-target-records-per-shard=50000
streamnova.shardplanner.fallback-max-records-per-shard=200000
streamnova.shardplanner.max-mb-per-shard=500
streamnova.shardplanner.pool-headroom-ratio=0.8

# Profiler: warm-up read rows and fetch size for throughput discovery.
streamnova.profiler.warm-up-rows=5000
streamnova.profiler.warm-up-fetch-size=1000

# Capacity: message and retry when request cannot be processed (e.g. 429). Minimal config.
streamnova.capacity.resource-limited-message=Due to minimal resources, the request cannot be processed. Please retry later.
streamnova.capacity.retry-after-sec=60
# Max shards (connections) for capacity checks. 0 = derive from pipeline_config maximumPoolSize (single source). Set >0 to override.
streamnova.capacity.max-shards=0
# Message when execute is rejected due to not enough shards (required > available).
streamnova.capacity.shards-not-available-message=Not enough shards available; please wait for full availability.
# Optional: max concurrent recommend requests; 0 = no limit. When limit hit, returns 429 with above message.
streamnova.recommend.max-concurrent-requests=0
# Seconds to wait for a slot before returning 429 (when max-concurrent-requests > 0).
streamnova.recommend.concurrent-request-acquire-timeout-sec=5

# Comma-separated source types for table statistics and startup datasource creation (e.g. postgres, oracle).
# When set to "postgres, oracle" use spring.profiles.active=postgres,oracle so application-postgres.properties
# and application-oracle.properties are both invoked; configs merge and datasources are created in parallel at startup.
# Use ?source=postgres or ?source=oracle in /api/pipeline/table-statistics and /api/pipeline/config.
streamnova.statistics.supported-source-types=postgres